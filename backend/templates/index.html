
<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>Analyzer Bot — Upload</title>
    <style>
      body{font-family:system-ui,Arial;padding:24px;max-width:900px;margin:auto}
      fieldset{margin:16px 0;padding:16px}
      .hint{color:#666}
      .runs a{display:block;margin:4px 0}
      .loading{display:none;color:#666;font-style:italic}
      .error{color:#d32f2f;display:none}
    </style>
  </head>
  <body>
    <h1>Analyzer Bot — Upload Scenario</h1>
    <form id="analyzeForm" enctype="multipart/form-data">
      <fieldset>
        <legend>Inputs</legend>
        <label>Scenario Video (mp4/mov): <input name="video" type="file" required></label><br/><br/>
        <label>Config (YAML/JSON/TOML/TXT): <input name="config_text" type="file" required></label><br/>
        <div class="hint">Golden list is loaded from server-side data/golden_bugs.csv (not uploaded per run).</div>
      </fieldset>
      <button type="submit">Analyze</button>
      <div class="loading">Analyzing... This may take a few minutes.</div>
      <div class="error">Analysis failed. Please try again.</div>
    </form>

    <script>
      document.getElementById('analyzeForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const form = e.target;
        const formData = new FormData(form);
        const submitBtn = form.querySelector('button[type="submit"]');
        const loading = form.querySelector('.loading');
        const error = form.querySelector('.error');
        
        // Show loading state
        submitBtn.disabled = true;
        loading.style.display = 'block';
        error.style.display = 'none';
        
        try {
          const response = await fetch('/analyze', {
            method: 'POST',
            body: formData
          });
          
          if (response.ok) {
            const result = await response.json();
            // Open report in new tab
            window.open(result.report_url, '_blank');
            // Reset form
            form.reset();
          } else {
            throw new Error('Analysis failed');
          }
        } catch (err) {
          error.style.display = 'block';
          console.error('Analysis error:', err);
        } finally {
          // Reset UI state
          submitBtn.disabled = false;
          loading.style.display = 'none';
        }
      });
    </script>

    <h2>Recent Runs</h2>
    <div class="runs">
      {% for run in runs %}
        <a href="/report/{{run}}">Report: {{run}}</a>
      {% else %}
        <em>No runs yet.</em>
      {% endfor %}
    </div>
  </body>
</html>
